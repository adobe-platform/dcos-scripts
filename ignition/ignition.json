{
  "ignition": {
    "version": "2.0.0",
    "config": {}
  },
  "storage": {
    "files": [
      {
        "filesystem": "root",
        "path": "/etc/modules-load.d/nf.conf",
        "contents": {
          "source": "data:,nf_conntrack%0A",
          "verification": {}
        },
        "mode": 420,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/etc/sysctl.d/kernel_tuning.conf",
        "contents": {
          "source": "data:,net.core.somaxconn%3D65535%0Anet.ipv4.ip_local_port_range%3D10240%20%2063999%0Anet.ipv4.tcp_tw_recycle%3D0%0Anet.ipv4.tcp_tw_reuse%3D1%0Anet.ipv4.tcp_max_syn_backlog%3D65535%0Anet.ipv4.tcp_max_tw_buckets%3D1440000%0Anet.ipv4.tcp_window_scaling%3D1%0Anet.core.netdev_max_backlog%3D250000%0Anet.ipv4.tcp_mtu_probing%3D1%0Anet.ipv4.tcp_slow_start_after_idle%3D0%0Afs.file-max%3D6511048%0Anet.netfilter.nf_conntrack_max%3D262144%0A",
          "verification": {}
        },
        "mode": 420,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/etc/systemd/journald.conf.d/dcos.conf",
        "contents": {
          "source": "data:,%5BJournal%5D%0AMaxLevelConsole%3Dwarning%0ARateLimitInterval%3D1s%0ARateLimitBurst%3D20000%0A",
          "verification": {}
        },
        "mode": 420,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/etc/docker-gc-exclude-containers",
        "contents": {
          "source": "data:,aquasec%0Ajenkins-data%0A",
          "verification": {}
        },
        "mode": 420,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/etc/docker-gc-exclude",
        "contents": {
          "source": "data:,.*aquasec.*%3A.*%0A.*%2Fklam-ssh%3A.*%0A.*jenkins-data.*%3A.*%0A",
          "verification": {}
        },
        "mode": 420,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/opt/ethos/bin/make_disk_resources.py",
        "contents": {
          "source": "data:,%23!%2Fopt%2Fmesosphere%2Fbin%2Fpython3%0Aimport%20json%0Aimport%20os%0Aimport%20re%0Aimport%20shutil%0Aimport%20subprocess%0Aimport%20sys%0Afrom%20datetime%20import%20datetime%0Afrom%20itertools%20import%20chain%0Afrom%20math%20import%20floor%0Afrom%20string%20import%20Template%0APROG%20%3D%20os.path.basename(__file__)%0AJSON_COMMON_TEMPLATE%20%3D%20Template('''%0A%7B%0A%20%20%20%20%22name%22%3A%20%22disk%22%2C%0A%20%20%20%20%22role%22%3A%20%22%24role%22%2C%0A%20%20%20%20%22scalar%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%22value%22%3A%20%24free_space%0A%20%20%20%20%7D%2C%0A%20%20%20%20%22type%22%3A%20%22SCALAR%22%0A%7D%0A''')%0AJSON_DISK_TEMPLATE%20%3D%20Template('''%0A%7B%0A%20%20%20%20%22disk%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%22source%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22type%22%3A%20%22PATH%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22path%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22root%22%3A%20%22%24mp%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D%0A''')%0AMOUNT_PATTERN%20%3D%20re.compile('on%5Cs%2B(%2Fdcos%2Fvolume%5Cd%2B)%5Cs%2B'%2C%20re.M%20%7C%20re.I)%0A%23%20Conversion%20factor%20for%20Bytes%20-%3E%20MB%20calculation%0AMB%20%3D%20float(1%20%3C%3C%2020)%0ATOLERANCE_MB%20%3D%20100%0ARESOURCES_TEMPLATE_HEADER%20%3D%20'''%23%20Generated%20by%20%7Bprog%7D%20on%20%7Bdt%7D%0A%23%0A'''%0ARESOURCES_TEMPLATE%20%3D%20'''%0AMESOS_RESOURCES%3D'%7Bres%7D'%0A'''%0Aclass%20VolumeDiscoveryException(Exception)%3A%0A%20%20%20%20pass%0Adef%20find_mounts_matching(pattern)%3A%0A%20%20%20%20'''%0A%20%20%20%20find%20all%20matching%20mounts%20from%20the%20output%20of%20the%20mount%20command%0A%20%20%20%20'''%0A%20%20%20%20print('Looking%20for%20mounts%20matching%20pattern%20%22%7B%7D%22'.format(pattern.pattern))%0A%20%20%20%20mounts%20%3D%20subprocess.check_output(%5B'mount'%5D%2C%20universal_newlines%3DTrue)%0A%20%20%20%20return%20pattern.findall(mounts)%0Adef%20make_disk_resources_json(mounts%2C%20role)%3A%0A%20%20%20%20'''%0A%20%20%20%20Disk%20resources%20are%20defined%20in%20https%3A%2F%2Fmesos.apache.org%2Fdocumentation%2Flatest%2Fmultiple-disk%2F%0A%20%20%20%20Substitute%20discovered%20mounts%20into%20JSON_TEMPLATE%2C%20returning%20a%20list%20of%20Mounts%0A%20%20%20%20%40type%20mounts%3A%20tuple(mount_point%2C%20free_space_in_mb)%0A%20%20%20%20%40rtype%3A%20list%0A%20%20%20%20'''%0A%20%20%20%20for%20(mp%2C%20fs)%20in%20mounts%3A%0A%20%20%20%20%20%20%20%20common%20%3D%20JSON_COMMON_TEMPLATE.substitute(free_space%3Dfs%2C%20role%3Drole)%0A%20%20%20%20%20%20%20%20disk%20%3D%20JSON_DISK_TEMPLATE.substitute(mp%3Dmp)%0A%20%20%20%20%20%20%20%20yield%20json.loads(common)%2C%20json.loads(disk)%0Adef%20get_disk_free(path)%3A%0A%20%20%20%20'''%0A%20%20%20%20%40type%20path%3A%20str%0A%20%20%20%20%40rtype%20tuple%0A%20%20%20%20'''%0A%20%20%20%20return%20(path%2C%20floor(float(shutil.disk_usage(path).free)%20%2F%20MB))%0Adef%20get_mounts_and_freespace(matching_mounts)%3A%0A%20%20%20%20for%20mount%2C%20free_space%20in%20map(get_disk_free%2C%20matching_mounts)%3A%0A%20%20%20%20%20%20%20%20net_free_space%20%3D%20free_space%20-%20TOLERANCE_MB%0A%20%20%20%20%20%20%20%20if%20net_free_space%20%3C%3D%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Per%20%40cmaloney%20and%20%40lingmann%2C%20we%20should%20hard%20exit%20here%20if%20volume%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20doesn't%20have%20sufficient%20space.%0A%20%20%20%20%20%20%20%20%20%20%20%20raise%20VolumeDiscoveryException(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'%7B%7D%20has%20%7B%7D%20MB%20net%20free%20space%2C%20expected%20%3E%20100M'.format(mount%2C%20net_free_space)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20yield%20(mount%2C%20net_free_space)%0Adef%20_handle_root_volume(root_volume%2C%20role)%3A%0A%20%20%20%20os.makedirs(root_volume%2C%20exist_ok%3DTrue)%0A%20%20%20%20for%20common%2C%20_%20in%20make_disk_resources_json(get_mounts_and_freespace(%5Broot_volume%5D)%2C%20role)%3A%0A%20%20%20%20%20%20%20%20yield%20common%2C%20%7B%7D%0Adef%20stitch(parts)%3A%0A%20%20%20%20common%2C%20disk%20%3D%20parts%0A%20%20%20%20common.update(disk)%0A%20%20%20%20return%20common%0Adef%20main(output_env_file)%3A%0A%20%20%20%20'''%0A%20%20%20%20Find%20mounts%20and%20freespace%20matching%20MOUNT_PATTERN%2C%20create%20RESOURCES%20for%20the%0A%20%20%20%20disks%2C%20and%20merge%20the%20list%20of%20disk%20resources%20with%20optionally%20existing%0A%20%20%20%20MESOS_RESOURCES%20environment%20varianble.%0A%20%20%20%20%40type%20output_env_file%3A%20str%2C%20filename%20to%20write%20resources%0A%20%20%20%20'''%0A%20%20%20%20if%20os.path.exists(output_env_file)%3A%0A%20%20%20%20%20%20%20%20print('Voume%20discovery%20assumed%20to%20be%20completed%20because%20%7B%7D%20exists'.format(output_env_file))%0A%20%20%20%20%20%20%20%20return%0A%20%20%20%20mounts_dfree%20%3D%20list(get_mounts_and_freespace(find_mounts_matching(MOUNT_PATTERN)))%0A%20%20%20%20print('Found%20matching%20mounts%20%3A%20%7B%7D'.format(mounts_dfree))%0A%20%20%20%20role%20%3D%20os.getenv('MESOS_DEFAULT_ROLE'%2C%20'*')%0A%20%20%20%20disk_resources%20%3D%20list(%0A%20%20%20%20%20%20%20%20map(%0A%20%20%20%20%20%20%20%20%20%20%20%20stitch%2C%20chain(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20make_disk_resources_json(mounts_dfree%2C%20role)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_handle_root_volume(os.environ%5B'MESOS_WORK_DIR'%5D%2C%20role)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20)%0A%20%20%20%20print('Generated%20disk%20resources%20map%3A%20%7B%7D'.format(disk_resources))%0A%20%20%20%20%23%20write%20contents%20to%20a%20temporary%20file%0A%20%20%20%20tmp_file%20%3D%20'%7B%7D.tmp'.format(output_env_file)%0A%20%20%20%20with%20open(tmp_file%2C%20'w')%20as%20env_file%3A%0A%20%20%20%20%20%20%20%20env_file.write(RESOURCES_TEMPLATE_HEADER.format(prog%3DPROG%2C%20dt%3Ddatetime.now()))%0A%20%20%20%20%20%20%20%20if%20disk_resources%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20msg%20%3D%20'Creating%20updated%20environment%20artifact%20file%20%3A%20%7B%7D'%0A%20%20%20%20%20%20%20%20%20%20%20%20env_resources%20%3D%20os.environ.get('MESOS_RESOURCES'%2C%20'%5B%5D')%0A%20%20%20%20%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20resources%20%3D%20json.loads(env_resources)%0A%20%20%20%20%20%20%20%20%20%20%20%20except%20ValueError%20as%20e%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print('ERROR%3A%20Invalid%20MESOS_RESOURCES%20JSON%20%7B%7D%20---%20%7B%7D'.format(e%2C%20env_resources)%2C%20file%3Dsys.stderr)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sys.exit(1)%0A%20%20%20%20%20%20%20%20%20%20%20%20resources.extend(disk_resources)%0A%20%20%20%20%20%20%20%20%20%20%20%20env_file.write(RESOURCES_TEMPLATE.format(res%3Djson.dumps(resources)))%0A%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20msg%20%3D%20'No%20additional%20volumes.%20Empty%20artifact%20file%20%7B%7D%20created'%0A%20%20%20%20print(msg.format(output_env_file))%0A%20%20%20%20%23%20Now%20rename%20tmp%20file%20to%20final%20file.%20This%20guarantees%20that%20anything%20reading%0A%20%20%20%20%23%20this%20file%20never%20sees%20a%20%22partial%22%20version%20of%20the%20file.%20It%20either%20doesn't%0A%20%20%20%20%23%20exist%20or%20it%20is%20there%20with%20full%20contents.%0A%20%20%20%20os.rename(tmp_file%2C%20output_env_file)%0Aif%20__name__%20%3D%3D%20'__main__'%3A%0A%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20main(sys.argv%5B1%5D)%0A%20%20%20%20except%20KeyError%20as%20e%3A%0A%20%20%20%20%20%20%20%20print('ERROR%3A%20Missing%20key%20%7B%7D'.format(e)%2C%20file%3Dsys.stderr)%0A%20%20%20%20%20%20%20%20sys.exit(1)%0A%20%20%20%20except%20VolumeDiscoveryException%20as%20e%3A%0A%20%20%20%20%20%20%20%20print('ERROR%3A%20%7B%7D'.format(e)%2C%20file%3Dsys.stderr)%0A%20%20%20%20%20%20%20%20sys.exit(1)%0A",
          "verification": {}
        },
        "mode": 493,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/opt/ethos/bin/format-and-mount-disks",
        "contents": {
          "source": "data:,%23!%2Fbin%2Fbash%0Aset%20-x%0Aset%20-v%0A%0Await_for()%20%7B%0A%20%20%20%20local%20max_wait%3D%241%3B%20shift%0A%20%20%20%20local%20cmd%3D%22%24*%22%0A%20%20%20%20local%20i%0A%20%20%20%20echo%20%22Waiting%20for%3A%20%24cmd%22%0A%20%20%20%20for%20((%20i%20%3D%200%3B%20i%20%3C%20max_wait%3B%20i%2B%2B%20))%3B%20do%0A%20%20%20%20%20%20%20%20echo%20-n%20'.'%3B%20sleep%201%0A%20%20%20%20%20%20%20%20if%20eval%20%24cmd%20%3E%20%2Fdev%2Fnull%202%3E%261%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%20Done%22%0A%20%20%20%20%20%20%20%20%20%20%20%20return%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20done%0A%20%20%20%20echo%20%22Failed%22%20%3B%20echo%20%22Giving%20up%20on%20command%3A%20%24cmd%22%0A%20%20%20%20return%201%0A%7D%0A%0Aformat_disk()%20%7B%0A%20%20%20%20local%20device%3D%241%0A%20%20%20%20local%20part_count%3D%242%0A%20%20%20%20local%20part_index%3D%243%0A%20%20%20%20part_percent%3D%24((100%20%2F%20%24part_count))%0A%20%20%20%20se%3D%24((%20%24part_index%20-%201%20))%0A%20%20%20%20if%20%5B%20-b%20%24%7Bdevice%7D%24%7Bpart_index%7D%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20echo%20%22Partition%20already%20exists%22%0A%20%20%20%20%20%20%20%20return%0A%20%20%20%20fi%0A%20%20%20%20if%20((%20%24part_index%20%3D%3D%201%20))%3B%20then%0A%20%20%20%20%20%20%20%20parted%20-s%20%24%7Bdevice%7D%20mklabel%20gpt%0A%20%20%20%20fi%0A%20%20%20%20parted%20-s%20-a%20optimal%20%24device%20%5C%0A%20%20%20%20%20%20%20%20mkpart%20primary%20xfs%20%24((%20%24se%20*%20%24part_percent%20))%25%20%24((%20(%24se%20%2B%201)%20*%20%24part_percent%20))%25%0A%20%20%20%20partprobe%20%24device%20%7C%7C%20true%0A%20%20%20%20if%20!%20wait_for%205%20ls%20%24%7Bdevice%7D%24%7Bpart_index%7D%3B%20then%0A%20%20%20%20%20%20%20%20echo%20%22Failed%20to%20create%20partition%3A%20%24%7Bdevice%7D%24%7Bpart_index%7D%22%0A%20%20%20%20%20%20%20%20return%201%0A%20%20%20%20fi%0A%20%20%20%20if%20!%20mkfs.xfs%20-f%20%24%7Bdevice%7D%24%7Bpart_index%7D%3B%20then%0A%20%20%20%20%20%20%20%20echo%20%22Failed%20to%20format%20partition%3A%20%24%7Bdevice%7D%24%7Bpart_index%7D%22%0A%20%20%20%20%20%20%20%20return%201%0A%20%20%20%20fi%0A%7D%0A%0Amount_disk()%20%7B%0A%20%20%20%20local%20part%3D%241%0A%20%20%20%20local%20mount_point%3D%242%0A%20%20%20%20if%20%5B%20!%20-b%20%24%7Bpart%7D%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20echo%20%22Partition%20does%20not%20exist%3A%20%24%7Bpart%7D%22%0A%20%20%20%20%20%20%20%20return%201%0A%20%20%20%20fi%0A%20%20%20%20%5B%5B%20!%20-d%20%24%7Bmount_point%7D%20%5D%5D%20%26%26%20mkdir%20-p%20-m%20755%20%24%7Bmount_point%7D%0A%20%20%20%20if%20mountpoint%20-q%20--%20%22%24%7Bmount_point%7D%22%3B%20then%0A%20%20%20%20%20%20%20%20echo%20%22%24%7Bmount_point%7D%20is%20already%20mounted%22%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20for%20((%20i%20%3D%200%3B%20i%20%3C%205%3B%20i%2B%2B%20))%3B%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20mount%20%24%7Bpart%7D%20%24%7Bmount_point%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20!%20wait_for%202%20mountpoint%20-q%20--%20%22%24%7Bmount_point%7D%22%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Could%20not%20mount%20%24%7Bpart%7D%20%40%20%24%7Bmount_point%7D%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%201%0A%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20done%0A%20%20%20%20fi%0A%20%20%20%20if%20!%20grep%20-q%20%22%24%7Bpart%7D%20%24%7Bmount_point%7D%22%20%2Fetc%2Ffstab%3B%20then%0A%20%20%20%20%20%20%20%20echo%20%22%24%7Bpart%7D%20%24%7Bmount_point%7D%20xfs%20rw%2Crelatime%2Cattr2%2Cinode64%2Cnoquota%2Cnofail%200%200%22%20%3E%3E%20%2Fetc%2Ffstab%0A%20%20%20%20fi%0A%20%20%20%20return%0A%7D%0A%0Amain()%20%7B%0A%20%20%20%20n%3D0%0A%0A%20%20%20%20if%20%5B%5B%20-f%20%2Fetc%2Fmesosphere%2Froles%2Faws%20%5D%5D%3B%20then%0A%20%20%20%20%20%20device_prefix%3D%2Fdev%2Fxvd%0A%20%20%20%20%20%20first_device%3Db%0A%20%20%20%20fi%0A%20%20%20%20if%20%5B%5B%20-f%20%2Fetc%2Fmesosphere%2Froles%2Fazure%20%5D%5D%3B%20then%0A%20%20%20%20%20%20device_prefix%3D%2Fdev%2Fsd%0A%20%20%20%20%20%20first_device%3Dc%0A%20%20%20%20fi%0A%20%20%20%20device_count%3D%24(ls%20%24%7Bdevice_prefix%7D*%20%7C%20grep%20%22%24%7Bdevice_prefix%7D%5B%24%7Bfirst_device%7D-z%5D%24%22%20%7C%20wc%20-l)%0A%20%20%20%20if%20((%20%24device_count%20%3E%200%20))%3B%20then%0A%20%20%20%20%20%20%20%20if%20((%20%24device_count%20%3D%3D%201%20))%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20format_disk%20%24%7Bdevice_prefix%7D%24%7Bfirst_device%7D%202%201%0A%20%20%20%20%20%20%20%20%20%20%20%20mount_disk%20%24%7Bdevice_prefix%7D%24%7Bfirst_device%7D1%20%2Fdcos%2Fvolume0%0A%20%20%20%20%20%20%20%20%20%20%20%20format_disk%20%24%7Bdevice_prefix%7D%24%7Bfirst_device%7D%202%202%0A%20%20%20%20%20%20%20%20%20%20%20%20mount_disk%20%24%7Bdevice_prefix%7D%24%7Bfirst_device%7D2%20%2Fdcos%2Fvolume1%0A%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20n%3D0%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20device%20in%20%24(ls%20%24%7Bdevice_prefix%7D*%20%7C%20grep%20%22%24%7Bdevice_prefix%7D%5B%24%7Bfirst_device%7D-z%5D%24%22)%3B%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20format_disk%20%24%7Bdevice%7D%201%201%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mount_disk%20%24%7Bdevice%7D1%20%2Fdcos%2Fvolume%24%7Bn%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((%20n%2B%2B%20))%0A%20%20%20%20%20%20%20%20%20%20%20%20done%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%7D%0Amain%0A",
          "verification": {}
        },
        "mode": 493,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/opt/ethos/bin/docker-encrypted-disk",
        "contents": {
          "source": "data:,%23!%2Fbin%2Fbash%0A%0Aif%20%5B%5B%20%24(df%20-h%20%7C%20grep%20%2Fvar%2Flib%2Fdocker)%20%5D%5D%3B%20then%20exit%200%3B%20fi%0A%0Amkfs%20-t%20xfs%20%2Fdev%2Fxvdh%0Amkdir%20-p%20%2Fvar%2Flib%2Fdocker%0Aecho%20'%2Fdev%2Fxvdh%20%20%20%2Fvar%2Flib%2Fdocker%20%20%20auto%20%20%20%20noatime%200%20%20%200'%20%3E%3E%20%2Fetc%2Ffstab%0Amount%20%2Fvar%2Flib%2Fdocker%0Arestorecon%20-R%20-v%20%2Fvar%2Flib%2Fdocker%2F%0A%0Aexit%200%0A",
          "verification": {}
        },
        "mode": 493,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/opt/ethos/bin/setup-auth-files",
        "contents": {
          "source": "data:,%23!%2Fbin%2Fbash%0A%0Asource%20%2Fetc%2Fethos%2Fauth.env%0A%0Aif%20%5B%5B%20-z%20%22%24SEED%22%20%5D%5D%3B%20then%20echo%20%22No%20seed%20value%20provided.%22%3B%20exit%201%3B%20fi%0Aif%20%5B%5B%20-z%20%22%24SERVICES%22%20%5D%5D%3B%20then%20echo%20%22No%20services%20provided.%22%3B%20exit%201%3B%20fi%0A%0ASERVICES%3D%22%24(echo%20-e%20%22%24%7BSERVICES%7D%22%20%7C%20tr%20-d%20'%5B%3Aspace%3A%5D')%22%0AIFS%3D'%2C'%20read%20-r%20-a%20array%20%3C%3C%3C%20%22%24SERVICES%22%0A%0Amkdir%20-p%20%2Fetc%2Fethos%0A%0ACREDS%3D'%7B%22credentials%22%3A%5B'%0A%0Afor%20SERVICE%20in%20%22%24%7Barray%5B%40%5D%7D%22%0Ado%0A%20%20SECRET%3D%24(echo%20-n%20%22%24SEED%24SERVICE%22%20%7C%20%2Fusr%2Fbin%2Fsha512sum%20%7C%20cut%20-c1-40)%0A%0A%20%20if%20%5B%5B%20%22%24SERVICE%22%20%3D%3D%20%22mesos-agent%22%20%5D%5D%3B%20then%0A%20%20%20%20echo%20-n%20%22%7B%5C%22principal%5C%22%3A%5C%22dcos-mesos-agent%5C%22%2C%5C%22secret%5C%22%3A%5C%22%24SECRET%5C%22%7D%22%20%3E%20%2Fetc%2Fethos%2Fdcos-mesos-agent-secret%0A%20%20%20%20chmod%20400%20%2Fetc%2Fethos%2Fdcos-mesos-agent-secret%0A%20%20else%0A%20%20%20%20echo%20-n%20%22%24SECRET%22%20%3E%20%2Fetc%2Fethos%2Fdcos-%24SERVICE-secret%0A%20%20%20%20chmod%20444%20%2Fetc%2Fethos%2Fdcos-%24SERVICE-secret%0A%20%20fi%0A%0A%20%20if%20%5B%20%22%24SERVICE%22%20%3D%3D%20%22marathon%22%20%5D%3B%20then%20SERVICE%3D%22_%22%24SERVICE%3B%20else%20SERVICE%3D%22-%22%24SERVICE%3B%20fi%0A%20%20CREDS%3D%22%24CREDS%7B%5C%22principal%5C%22%3A%5C%22dcos%24SERVICE%5C%22%2C%5C%22secret%5C%22%3A%5C%22%24SECRET%5C%22%7D%2C%22%0Adone%0A%0A%23%20Remove%20the%20trailing%20comma%0ACREDS%3D%24%7BCREDS%3A%3A-1%7D%0ACREDS%3D%22%24CREDS%5D%7D%22%0A%0Aif%20%5B%5B%20%22%24ROLE%22%20%3D%3D%20%22master%22%20%5D%5D%3B%20then%0A%20%20echo%20-n%20%22%24CREDS%22%20%3E%20%2Fetc%2Fethos%2Fdcos-mesos-master-secrets%0A%20%20chmod%20440%20%2Fetc%2Fethos%2Fdcos-mesos-master-secrets%0Afi%0A%0Arm%20%2Fetc%2Fethos%2Fauth.env%0A",
          "verification": {}
        },
        "mode": 493,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/opt/ethos/bin/dcos-exhibitor-ssl",
        "contents": {
          "source": "data:,%23!%2Fbin%2Fbash%0Aenvfiles%3D%22%2Fetc%2Fethos%2Fexhibitor.env%22%0Afor%20f%20in%20%24envfiles%0Ado%0A%20%20if%20%5B%20-f%20%24f%20%5D%3B%20then%0A%20%20%20%20source%20%24f%0A%20%20fi%0Adone%0Aif%20%5B%5B%20%22%24SSLFRAMEWORK_ENABLED%22%20%3D%3D%20%22true%22%20%5D%5D%3B%20then%0A%20%20echo%20%22SSLFRAMEWORK%20ENABLED%2C%20Configuring%20SecureClient%20Port%22%0A%20%20if%20!%20grep%20%22secureClientPort%22%20%24(grep%20ExecStart%20%2Fetc%2Fsystemd%2Fsystem%2Fdcos-exhibitor.service%20%7C%20awk%20-F'%3D'%20'%7Bprint%20%242%7D')%3B%20then%20sed%20-i%20s%2Fzoo-cfg-extra%3D%2Fzoo-cfg-extra%3DsecureClientPort%5C%5C%5C%5C%3D2281%5C%5C%5C%26%2Fg%20%24(grep%20ExecStart%20%2Fetc%2Fsystemd%2Fsystem%2Fdcos-exhibitor.service%20%7C%20awk%20-F'%3D'%20'%7Bprint%20%242%7D')%3B%20fi%0Afi%0A",
          "verification": {}
        },
        "mode": 493,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/opt/ethos/bin/dcos-marathon-ssl",
        "contents": {
          "source": "data:,%23!%2Fbin%2Fbash%0Aenvfiles%3D%22%2Fetc%2Fethos%2Fmarathon.env%20%2Fetc%2Fmesosphere%2Fsetup-packages%2Fdcos-provider-*%2Fetc%2Fmesos-master-provider%22%0Afor%20f%20in%20%24envfiles%0Ado%0A%20%20if%20%5B%20-f%20%24f%20%5D%3B%20then%0A%20%20%20%20source%20%24f%0A%20%20fi%0Adone%0Aif%20%5B%5B%20%22%24SSLFRAMEWORK_ENABLED%22%20%3D%3D%20%22true%22%20%5D%5D%3B%20then%0A%20%20echo%20%22SSLFRAMEWORK%20ENABLED%3A%20Configuring%20Marathon%20Systemd%20Service%20With%20KeyStore%22%0Afi%0A",
          "verification": {}
        },
        "mode": 493,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/opt/ethos/bin/dcos-sslframework-setup",
        "contents": {
          "source": "data:,%23!%2Fbin%2Fbash%0Aenvfiles%3D%22%2Fetc%2Fethos%2Fsslframework.env%20%2Fetc%2Fmesosphere%2Fsetup-packages%2Fdcos-provider-*%2Fetc%2Fmesos-master-provider%22%0AREGEXURL%3D'(https%3F%7Cftp%7Cfile)%3A%2F%2F%5B-A-Za-z0-9%5C%2B%26%40%23%2F%25%3F%3D~_%7C!%3A%2C.%3B%5D*%5B-A-Za-z0-9%5C%2B%26%40%23%2F%25%3D~_%7C%5D'%0Afor%20f%20in%20%24envfiles%0Ado%0A%20%20if%20%5B%20-f%20%24f%20%5D%3B%20then%0A%20%20%20%20source%20%24f%0A%20%20fi%0Adone%0Aif%20%5B%5B%20%24MESOS_CLUSTER%20%5D%5D%3B%20then%0A%20%20%20%20SHAREDBUCKET%3D%60echo%20%24MESOS_CLUSTER%20%7C%20awk%20-F%20'-'%20'%7Bprint%20%241%22-%22%242%22-%22%243%22-shared%22%7D'%60%0Aelse%0A%20%20if%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-flags%20%5D%3B%20then%0A%20%20%20%20SHAREDBUCKET%3D%60grep%20-A1%20aws_stack_name%20%2Fetc%2Fmesosphere%2Fsetup-flags%2Flate-config.yaml%20%7C%20tail%20-1%20%7C%20awk%20-F%20'-'%20'%7Bprint%20%241%22-%22%242%22-%22%243%22-shared%22%7D'%20%7C%20awk%20'%7B%241%3D%241%7D%3B1'%60%0A%20%20else%0A%20%20%20%20SHAREDBUCKET%3D%22%22%0A%20%20fi%0Afi%0Acat%20%3C%3C%20EOF%20%3E%20%2Fetc%2Fethos%2Fmesos.env%0ALIBPROCESS_SSL_ENABLED%3Dfalse%0AEOF%0Aif%20%5B%5B%20%22%24SSLFRAMEWORK_ENABLED%22%20%3D%3D%20%22true%22%20%5D%5D%3B%20then%0A%20%20%20%20echo%20%22SSLFRAMEWORK%20ENABLED%20Configuring%20Frameworks%22%0A%20%20%23%20securing%20zookeeper%2Fexhibitor%0A%20%20if%20%5B%5B%20%22%24SSLZK_ENABLED%22%20%3D%3D%20%22true%22%20%5D%5D%3B%20then%0A%20%20%20%20echo%20%22Enabling%20SSL%20in%20Zookeeper%20framework%3A%20Port%202281%22%0A%20%20%20%20%23checking%20download%20urls%0A%20%20%20%20if%20%5B%5B%20%24ZK_SSLKEYSTORE_URL%20%3D~%20%24REGEXURL%20%5D%5D%3B%20then%0A%20%20%20%20%20%20wget%20--no-check-certificate%20%22%24ZK_SSLKEYSTORE_URL%22%20-O%20%2Fetc%2Fethos%2Fzk.jks%0A%20%20%20%20else%0A%20%20%20%20%20%20if%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-packages%2Fdcos-provider-aws*%20%5D%20%7C%7C%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-flags%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20wget%20--no-check-certificate%20%22https%3A%2F%2Fs3.amazonaws.com%2F%24SHAREDBUCKET%2F%24ZK_SSLKEYSTORE_URL%22%20-O%20%2Fetc%2Fethos%2Fzk.jks%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20echo%20%22invalid%20sslkeystore%20download%20url%22%0A%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%20%20%20%20if%20%5B%5B%20%24ZK_SSLTRUSTSTORE_URL%20%3D~%20%24REGEXURL%20%5D%5D%3B%20then%0A%20%20%20%20%20%20wget%20--no-check-certificate%20%22%24ZK_SSLTRUSTSTORE_URL%22%20-O%20%2Fetc%2Fethos%2Fzktrust.jks%0A%20%20%20%20else%0A%20%20%20%20%20%20if%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-packages%2Fdcos-provider-aws*%20%5D%20%7C%7C%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-flags%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20wget%20--no-check-certificate%20%22https%3A%2F%2Fs3.amazonaws.com%2F%24SHAREDBUCKET%2F%24ZK_SSLTRUSTSTORE_URL%22%20-O%20%2Fetc%2Fethos%2Fzktrust.jks%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20echo%20%22invalid%20ssltruststore%20download%20url%22%0A%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%20%20%20%20mkdir%20-p%20%2Fvar%2Flib%2Fdcos%2Fexhibitor%2Fconf%2F%0A%20%20%20%20while%20%5B%20!%20-d%20%2Fvar%2Flib%2Fdcos%2Fexhibitor%2Fconf%20%5D%0A%20%20%20%20do%0A%20%20%20%20%20%20sleep%202%0A%20%20%20%20done%0A%20%20%20%20cat%20%2Fetc%2Fethos%2Fsslframework.env%20%3E%20%2Fvar%2Flib%2Fdcos%2Fexhibitor%2Fconf%2Fjava.env%0Acat%20%3C%3C%20EOF%20%3E%3E%20%2Fvar%2Flib%2Fdcos%2Fexhibitor%2Fconf%2Fjava.env%0A%0Aexport%20SERVER_JVMFLAGS%3D%22-Dzookeeper.serverCnxnFactory%3Dorg.apache.zookeeper.server.NettyServerCnxnFactory%20-Dzookeeper.ssl.keyStore.location%3D%2Fetc%2Fethos%2Fzk.jks%20-Dzookeeper.ssl.keyStore.password%3D%24ZK_SSLKEYSTORE_PASSWORD%20-Dzookeeper.ssl.trustStore.location%3D%2Fetc%2Fethos%2Fzktrust.jks%20-Dzookeeper.ssl.trustStore.password%3D%24ZK_SSLTRUSTSTORE_PASSWORD%22%0Aexport%20CLIENT_JVMFLAGS%3D%22-Dzookeeper.clientCnxnSocket%3Dorg.apache.zookeeper.ClientCnxnSocketNetty%20-Dzookeeper.client.secure%3Dtrue%20-Dzookeeper.ssl.keyStore.location%3D%2Fetc%2Fethos%2Fzk.jks%20-Dzookeeper.ssl.keyStore.password%3D%24ZK_SSLKEYSTORE_PASSWORD%20-Dzookeeper.ssl.trustStore.location%3D%2Fetc%2Fethos%2Fzktrust.jks%20-Dzookeeper.ssl.trustStore.password%3D%24ZK_SSLTRUSTSTORE_PASSWORD%22%0AEOF%0A%20%20%20%20cp%20%2Fetc%2Fethos%2Fsslframework.env%20%2Fetc%2Fethos%2Fexhibitor.env%0A%20%20%20%20while%20!%20id%20-u%20%22dcos_exhibitor%22%20%3E%20dev%2Fnull%202%3E%261%3B%0A%20%20%20%20do%0A%20%20%20%20%20%20sleep%202%0A%20%20%20%20done%0A%20%20%20%20while%20%5B%20!%20-f%20%2Fopt%2Fmesosphere%2Fpackages%2F%24(ls%20%2Fopt%2Fmesosphere%2Fpackages%20%7C%20grep%20exhibitor%20%7C%20head%20-1)%2Fdcos.target.wants_master%2Fdcos-exhibitor.service%20%5D%0A%20%20%20%20do%0A%20%20%20%20%20%20sleep%202%0A%20%20%20%20done%0A%20%20%20%20chown%20-R%20dcos_exhibitor%3Adcos_exhibitor%20%2Fopt%2Fmesosphere%2Fpackages%2F%24(ls%20%2Fopt%2Fmesosphere%2Fpackages%20%7C%20grep%20exhibitor%20%7C%20head%20-1)%0A%20%20%20%20chown%20-R%20dcos_exhibitor%3Adcos_exhibitor%20%24(grep%20ExecStart%20%2Fopt%2Fmesosphere%2Fpackages%2F%24(ls%20%2Fopt%2Fmesosphere%2Fpackages%20%7C%20grep%20exhibitor%20%7C%20head%20-1)%2Fdcos.target.wants_master%2Fdcos-exhibitor.service%20%7C%20awk%20-F'%3D'%20'%7Bprint%20%242%7D'%20%7C%20awk%20-F'%2Fstart_exhibitor'%20'%7Bprint%20%241%7D')%0A%20%20%20%20chown%20dcos_exhibitor%3Adcos_exhibitor%20%2Fvar%2Flib%2Fdcos%2Fexhibitor%2Fconf%2Fjava.env%0A%20%20%20%20chown%20dcos_exhibitor%3Adcos_exhibitor%20%2Fetc%2Fethos%2Fexhibitor.env%0A%20%20%20%20chown%20dcos_exhibitor%3Adcos_exhibitor%20%2Fetc%2Fethos%2Fzk.jks%0A%20%20fi%0A%20%20%23%20securing%20mesos%0A%20%20if%20%5B%5B%20%22%24SSLMESOS_ENABLED%22%20%3D%3D%20%22true%22%20%5D%5D%3B%20then%0A%20%20%20%20echo%20%22Enabling%20SSL%20in%20Mesos%20framework%22%0A%20%20%20%20if%20%5B%5B%20%24MESOS_SSLKEY_URL%20%3D~%20%24REGEXURL%20%5D%5D%3B%20then%0A%20%20%20%20%20%20wget%20--no-check-certificate%20%22%24MESOS_SSLKEY_URL%22%20-O%20%2Fetc%2Fethos%2Fmesos.key%0A%20%20%20%20else%0A%20%20%20%20%20%20if%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-packages%2Fdcos-provider-aws*%20%5D%20%7C%7C%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-flags%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20wget%20--no-check-certificate%20%22https%3A%2F%2Fs3.amazonaws.com%2F%24SHAREDBUCKET%2F%24MESOS_SSLKEY_URL%22%20-O%20%2Fetc%2Fethos%2Fmesos.key%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20echo%20%22invalid%20mesos%20sslkey%20download%20url%22%0A%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%20%20%20%20if%20%5B%5B%20%24MESOS_SSLCERT_URL%20%3D~%20%24REGEXURL%20%5D%5D%3B%20then%0A%20%20%20%20%20%20wget%20--no-check-certificate%20%22%24MESOS_SSLCERT_URL%22%20-O%20%2Fetc%2Fethos%2Fmesos.pem%0A%20%20%20%20else%0A%20%20%20%20%20%20if%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-packages%2Fdcos-provider-aws*%20%5D%20%7C%7C%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-flags%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20wget%20--no-check-certificate%20%22https%3A%2F%2Fs3.amazonaws.com%2F%24SHAREDBUCKET%2F%24MESOS_SSLCERT_URL%22%20-O%20%2Fetc%2Fethos%2Fmesos.pem%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20echo%20%22invalid%20mesos%20cert%20download%20url%22%0A%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%20%20%20%20if%20%5B%5B%20%24MESOS_SSLCA_URL%20%3D~%20%24REGEXURL%20%5D%5D%3B%20then%0A%20%20%20%20%20%20wget%20--no-check-certificate%20%22%24MESOS_SSLCA_URL%22%20-O%20%2Fetc%2Fethos%2Fmesos-ca.pem%0A%20%20%20%20else%0A%20%20%20%20%20%20if%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-packages%2Fdcos-provider-aws*%20%5D%20%7C%7C%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-flags%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20wget%20--no-check-certificate%20%22https%3A%2F%2Fs3.amazonaws.com%2F%24SHAREDBUCKET%2F%24MESOS_SSLCA_URL%22%20-O%20%2Fetc%2Fethos%2Fmesos-ca.pem%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20echo%20%22invalid%20sslca%20download%20url%22%0A%20%20%20%20%20%20fi%0A%20%20%20%20fi%0Acat%20%3C%3C%20EOF%20%3E%20%2Fetc%2Fethos%2Fmesos.env%0ALIBPROCESS_SSL_ENABLED%3Dtrue%0ALIBPROCESS_SSL_SUPPORT_DOWNGRADE%3Dtrue%0ALIBPROCESS_SSL_KEY_FILE%3D%2Fetc%2Fethos%2Fmesos.key%0ALIBPROCESS_SSL_CERT_FILE%3D%2Fetc%2Fethos%2Fmesos.pem%0ALIBPROCESS_SSL_CA_DIR%3D%2Fetc%2Fssl%2Fcerts%0ALIBPROCESS_SSL_VERIFY_CERT%3Dfalse%0AEOF%0A%20%20%20%20ln%20-s%20%2Fetc%2Fethos%2Fmesos-ca.pem%20%2Fetc%2Fssl%2Fcerts%2Fmesos-ca.pem%0A%20%20%20%20update-ca-certificates%0A%20%20fi%0A%20%20%23%20securing%20marathon%0A%20%20if%20%5B%5B%20%22%24SSLMARATHON_ENABLED%22%20%3D%3D%20%22true%22%20%5D%5D%3B%20then%0A%20%20%20%20echo%20%22Enabling%20SSL%20in%20Marathon%20framework%3A%20Port%208443%22%0A%20%20%20%20if%20%5B%5B%20%24MARATHON_SSLKEYSTORE_URL%20%3D~%20%24REGEXURL%20%5D%5D%3B%20then%0A%20%20%20%20%20%20wget%20--no-check-certificate%20%22%24MARATHON_SSLKEYSTORE_URL%22%20-O%20%2Fetc%2Fethos%2Fmarathon.jks%0A%20%20%20%20else%0A%20%20%20%20%20%20if%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-packages%2Fdcos-provider-aws*%20%5D%20%7C%7C%20%5B%20-d%20%2Fetc%2Fmesosphere%2Fsetup-flags%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20wget%20--no-check-certificate%20%22https%3A%2F%2Fs3.amazonaws.com%2F%24SHAREDBUCKET%2F%24MARATHON_SSLKEYSTORE_URL%22%20-O%20%2Fetc%2Fethos%2Fmarathon.jks%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20echo%20%22invalid%20marathon%20sslkeystore%20download%20url%22%0A%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%20%20%20%20cp%20%2Fetc%2Fethos%2Fsslframework.env%20%2Fetc%2Fethos%2Fmarathon.env%0A%20%20%20%20while%20!%20id%20-u%20%22dcos_marathon%22%20%3E%20%2Fdev%2Fnull%202%3E%261%3B%0A%20%20%20%20do%0A%20%20%20%20%20%20sleep%202%0A%20%20%20%20done%0A%20%20%20%20while%20%5B%20!%20-f%20%2Fopt%2Fmesosphere%2Fpackages%2F%24(ls%20%2Fopt%2Fmesosphere%2Fpackages%20%7C%20grep%20marathon%20%7C%20head%20-1)%2Fdcos.target.wants_master%2Fdcos-marathon.service%20%5D%0A%20%20%20%20do%0A%20%20%20%20%20%20sleep%202%0A%20%20%20%20done%0A%20%20%20%20echo%20%22SSLFRAMEWORK%20ENABLED%3A%20Configuring%20Marathon%20Systemd%20Service%20With%20KeyStore%22%0A%20%20%20%20sed%20-i%20'%2F--ssl_key%2Fd'%20%2Fopt%2Fmesosphere%2Fpackages%2F%24(ls%20%2Fopt%2Fmesosphere%2Fpackages%20%7C%20grep%20marathon%20%7C%20head%20-1)%2Fdcos.target.wants_master%2Fdcos-marathon.service%0A%20%20%20%20sed%20-i%20'%2F--mesos_user%2Fi%20%5C%0A%20%20%20%20%20%20--ssl_keystore_path%20%5C%2Fetc%5C%2Fethos%5C%2Fmarathon.jks%20%5C%5C%5C%0A%20%20%20%20%20%20--ssl_keystore_password%20%22'%22%24MARATHON_SSLKEYSTORE_PASSWORD%22'%22%20%5C%5C'%20%2Fopt%2Fmesosphere%2Fpackages%2F%24(ls%20%2Fopt%2Fmesosphere%2Fpackages%20%7C%20grep%20marathon%20%7C%20head%20-1)%2Fdcos.target.wants_master%2Fdcos-marathon.service%0A%20%20%20%20chown%20-R%20dcos_marathon%3Adcos_marathon%20%2Fopt%2Fmesosphere%2Fpackages%2F%24(ls%20%2Fopt%2Fmesosphere%2Fpackages%20%7C%20grep%20marathon%20%7C%20head%20-1)%0A%20%20%20%20chown%20dcos_marathon%3Adcos_marathon%20%2Fetc%2Fethos%2Fmarathon.env%0A%20%20%20%20chown%20dcos_marathon%3Adcos_marathon%20%2Fetc%2Fethos%2Fmarathon.jks%0A%20%20%20%20systemctl%20daemon-reload%0A%20%20fi%0Afi%0A",
          "verification": {}
        },
        "mode": 493,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/etc/ssh/sshd_config",
        "contents": {
          "source": "data:,%23%20Use%20most%20defaults%20for%20sshd%20configuration.%0AUsePrivilegeSeparation%20sandbox%0ASubsystem%20sftp%20internal-sftp%0AClientAliveInterval%20180%0AUseDNS%20no%0AUsePAM%20yes%0APrintLastLog%20no%20%23%20handled%20by%20PAM%0APrintMotd%20no%20%23%20handled%20by%20PAM%0AAuthorizedKeysCommandUser%20nobody%0AAuthorizedKeysCommand%20%2Fusr%2Fbin%2Fsss_ssh_authorizedkeys%0A",
          "verification": {}
        },
        "mode": 384,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/etc/sudoers.d/group-cst",
        "contents": {
          "source": "data:,%25CST%20ALL%3D(ALL)%20NOPASSWD%3A%20LOG_INPUT%3A%20LOG_OUTPUT%3A%20ALL%0A",
          "verification": {}
        },
        "mode": 384,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/etc/ip_detect",
        "contents": {
          "source": "data:,%23!%2Fbin%2Fsh%0Aset%20-o%20nounset%20-o%20errexit%0Aif%20%5B%20-e%20%2Fetc%2Fenvironment%20%5D%0Athen%0A%20%20set%20-o%20allexport%0A%20%20.%20%2Fetc%2Fenvironment%0A%20%20set%20%2Bo%20allexport%0Afi%0Aecho%20%24%7BCOREOS_PRIVATE_IPV4%3A-%24(ip%20addr%20%7C%20grep%20global%20%7C%20grep%20brd%20%7C%20awk%20'%7Bprint%20%242%7D'%20%7C%20cut%20-f1%20-d%22%2F%22)%7D%0A",
          "verification": {}
        },
        "mode": 493,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/opt/hubble.conf",
        "contents": {
          "source": "data:,Z2l0ZnNfcmVtb3RlczoKICAtIGh0dHBzOi8vZ2l0aHViLmNvbS9odWJibGVzdGFjay9odWJibGVzdGFja19kYXRhLmdpdDoKICAgIC0gYmFzZTogbWFzdGVyCmxvZ19maWxlOiAvZGV2L251bGwKZmlsZXNlcnZlcl9iYWNrZW5kOgogIC0gZ2l0CiAgLSByb290cwpzY2hlZHVsZToKICBhdWRpdF9kYWlseToKICAgIGZ1bmN0aW9uOiBodWJibGUuYXVkaXQKICAgIHNlY29uZHM6IDg2NDAwCiAgICBzcGxheTogMzYwMAogICAgcmV0dXJuZXI6IHNwbHVua19ub3ZhX3JldHVybgogIG5lYnVsYV9maWZ0ZWVuX21pbjoKICAgIGZ1bmN0aW9uOiBuZWJ1bGEucXVlcmllcwogICAgc2Vjb25kczogOTAwCiAgICBzcGxheTogMzAwCiAgICBhcmdzOgogICAgICAtIGZpZnRlZW5fbWluCiAgICByZXR1cm5lcjogc3BsdW5rX25lYnVsYV9yZXR1cm4KICAgIHJ1bl9vbl9zdGFydDogRmFsc2UKICBuZWJ1bGFfaG91cjoKICAgIGZ1bmN0aW9uOiBuZWJ1bGEucXVlcmllcwogICAgc2Vjb25kczogMzYwMAogICAgc3BsYXk6IDkwMAogICAgYXJnczoKICAgICAgLSBob3VyCiAgICByZXR1cm5lcjogc3BsdW5rX25lYnVsYV9yZXR1cm4KICBuZWJ1bGFfZGF5OgogICAgZnVuY3Rpb246IG5lYnVsYS5xdWVyaWVzCiAgICBzZWNvbmRzOiA4NjQwMAogICAgc3BsYXk6IDM2MDAKICAgIGFyZ3M6CiAgICAgIC0gZGF5CiAgICByZXR1cm5lcjogc3BsdW5rX25lYnVsYV9yZXR1cm4KICBwdWxzYXI6CiAgICBmdW5jdGlvbjogcHVsc2FyLnByb2Nlc3MKICAgIHNlY29uZHM6IDEKICAgIHJldHVybmVyOiBzcGx1bmtfcHVsc2FyX3JldHVybgogICAgcnVuX29uX3N0YXJ0OiBUcnVlCmh1YmJsZXN0YWNrOgogIG5vdmE6CiAgICByZXR1cm5lcjoKICAgICAgc3BsdW5rOgogICAgICAgIHRva2VuOiBERDE4QkY4MS02QzE5LTRGRjMtOTVCRC1CQThDQ0M4RTlBMUQKICAgICAgICBpbmRleGVyOiBoZWMuYWRvYmVzZWNhYXMuY29tCiAgICAgICAgc291cmNldHlwZTogaHViYmxlX2F1ZGl0CiAgICAgICAgaW5kZXg6IGh1YmJsZQogIG5lYnVsYToKICAgIHJldHVybmVyOgogICAgICBzcGx1bms6CiAgICAgICAgdG9rZW46IEREMThCRjgxLTZDMTktNEZGMy05NUJELUJBOENDQzhFOUExRAogICAgICAgIGluZGV4ZXI6IGhlYy5hZG9iZXNlY2Fhcy5jb20KICAgICAgICBzb3VyY2V0eXBlOiBodWJibGVfb3NxdWVyeQogICAgICAgIGluZGV4OiBodWJibGUKICBwdWxzYXI6CiAgICByZXR1cm5lcjoKICAgICAgc3BsdW5rOgogICAgICAgIHRva2VuOiBERDE4QkY4MS02QzE5LTRGRjMtOTVCRC1CQThDQ0M4RTlBMUQKICAgICAgICBpbmRleGVyOiBoZWMuYWRvYmVzZWNhYXMuY29tCiAgICAgICAgc291cmNldHlwZTogaHViYmxlX2ZpbQogICAgICAgIGluZGV4OiBodWJibGUKCg%3D%3D%0A",
          "verification": {}
        },
        "mode": 384,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/opt/hubble.sh",
        "contents": {
          "source": "data:,%23!%2Fbin%2Fbash%0Aif%20%5B%20!%20-f%20%2Fopt%2Fhubble%2Fhubble%20%5D%0Athen%0A%20%20wget%20--no-check-certificate%20https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fhubblestack-releases%2Fhubblestack-2.1.7-coreos.tar.gz%20-O%20%2Ftmp%2Fhubble.tar.gz%0A%20%20tar%20-xvPzf%20%2Ftmp%2Fhubble.tar.gz%0A%20%20cat%20%2Fopt%2Fhubble.conf%20%7C%20base64%20--decode%20%3E%20%2Fetc%2Fhubble%2Fhubble%0A%20%20sed%20-i%20%22s%2FSPLUNK_TOKEN%2F%24HUBBLE_SPLUNK_TOKEN%2Fg%22%20%2Fetc%2Fhubble%2Fhubble%0Afi%0A_ITER%3D3%0A_CHECK_HUBBLE_PROCESS%3D%60ps%20aux%20%7C%20grep%20-i%20hubble%20%7C%20grep%20-v%20grep%20%7C%20wc%20-l%60%0Aif%20%5B%20%20%22%24_CHECK_HUBBLE_PROCESS%22%20%3D%3D%20%220%22%20%5D%0Athen%0A%20%20rm%20-f%20%2Fvar%2Frun%2Fhubble.pid%0Afi%0Awhile%20%5B%20%24_ITER%20-gt%200%20%5D%20%26%26%20%5B%20-f%20%2Fvar%2Frun%2Fhubble.pid%20%5D%0Ado%0A%20%20if%20%5B%20-f%20%2Fvar%2Frun%2Fhubble.pid%20%5D%0A%20%20then%0A%20%20%20%20pkill%20hubble%0A%20%20fi%0A%20%20_ITER%3D%24((_ITER-1))%0Adone%0Aif%20%5B%20-f%20%2Fvar%2Frun%2Fhubble.pid%20%5D%0Athen%0A%20%20echo%20%22Did%20not%20start%20hubble%2C%20since%20the%20process%20is%20already%20running%20and%20cannot%20be%20killed%20...%22%0Aelse%0A%20%20%2Fopt%2Fhubble%2Fhubble%20-d%0Afi%0A",
          "verification": {}
        },
        "mode": 384,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/etc/ansible/facts.d/dynamic.fact",
        "contents": {
          "source": "data:,%23!%2Fbin%2Fbash%0A%23%20This%20script%20returns%20dynamic%20facts%20to%20Ansible.%0A%23%20Ansible%20requires%20that%20facts%20be%20stored%20as%20static%20.ini%20files%20or%20may%20also%0A%23%20consume%20executable%20files%20that%20return%20JSON%20(such%20as%20this%20one)%0A%0Amesos_slave_common_name%3D%24(cut%20-d%5C%3D%20-f1%20%2Fvar%2Flib%2Fdcos%2Fmesos-slave-common)%0Amesos_slave_common_val%3D%24(cut%20-d%5C%3D%20-f2%20%2Fvar%2Flib%2Fdcos%2Fmesos-slave-common)%0Acat%20%3C%3C%20END%0A%7B%0A%20%20%22%24%7Bmesos_slave_common_name%7D%22%3A%22%24%7Bmesos_slave_common_val%7D%22%0A%7D%0AEND%0A",
          "verification": {}
        },
        "mode": 365,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/opt/ethos/bin/configure_upstream_dns",
        "contents": {
          "source": "data:,%23!%2Fbin%2Fbash%0A%23%20If%20resolvers%20list%20is%20empty%20don't%20change%20anything%0Aif%20%5B%5B%20-z%20%22%24RESOLVERS%22%20%5D%5D%3B%20then%0A%20%20echo%20%22No%20upstream%20DNS%20resolvers%20configured.%20Exiting%20without%20changes.%22%0A%20%20exit%200%0Afi%0A%0Aecho%20%22Upstream%20DNS%20resolvers%3A%20%24RESOLVERS%22%0Aresolvers_json%3D%24(echo%20'%5B%22'%24%7BRESOLVERS%2F%2C%2F'%22%2C%22'%7D'%22%5D')%0A%0A%23%20Configure%20Spartan%0Aecho%20%22Waiting%20for%20Spartan%20to%20activate...%22%0Auntil%20systemctl%20-q%20is-active%20dcos-spartan.service%3B%20do%20sleep%201%3B%20done%0Aspartan_config%3D%2Fopt%2Fmesosphere%2Fetc%2Fspartan.json%0Aspartan_config_temp%3D%2Fopt%2Fmesosphere%2Fetc%2Fspartan.json.new%0A%20%20echo%20%22Configuring%20Spartan...%22%0Ajq%20--argjson%20resolvers%20%22%24resolvers_json%22%20'.upstream_resolvers%20%3D%20%24resolvers'%20%22%24spartan_config%22%20%20%3E%20%22%24spartan_config_temp%22%20%26%26%20mv%20%22%24spartan_config_temp%22%20%22%24spartan_config%22%0Ased%20-i%20%22s%2F%5ERESOLVERS%3D.*%24%2FRESOLVERS%3D%24RESOLVERS%2F%22%20%2Fopt%2Fmesosphere%2Fetc%2Fdns_config%0Asystemctl%20restart%20dcos-spartan.service%0Auntil%20systemctl%20-q%20is-active%20dcos-spartan.service%3B%20do%20sleep%201%3B%20done%0A%0A%23%20Configure%20Mesos%20DNS%20(if%20we%20are%20a%20master)%0Aif%20%5B%5B%20-f%20%2Fetc%2Fmesosphere%2Froles%2Fmaster%20%5D%5D%3B%20then%0A%20%20echo%20%22Waiting%20for%20Mesos%20DNS%20to%20activate...%22%0A%20%20until%20systemctl%20is-active%20dcos-mesos-dns.service%3B%20do%20sleep%201%3B%20done%0A%20%20mesos_config%3D%2Fopt%2Fmesosphere%2Fetc%2Fmesos-dns.json%0A%20%20mesos_config_temp%3D%2Fopt%2Fmesosphere%2Fetc%2Fmesos-dns.json.new%0A%20%20if%20%5B%20-f%20%22%24mesos_config%22%20%5D%3B%20then%0A%20%20%20%20echo%20%22Configuring%20Mesos%20DNS...%22%0A%20%20%20%20jq%20--argjson%20resolvers%20%22%24resolvers_json%22%20'.resolvers%20%3D%20%24resolvers'%20%22%24mesos_config%22%20%20%3E%20%22%24mesos_config_temp%22%20%26%26%20mv%20%22%24mesos_config_temp%22%20%22%24mesos_config%22%0A%20%20fi%0A%0A%20%20systemctl%20restart%20dcos-mesos-dns.service%0A%20%20until%20systemctl%20is-active%20dcos-mesos-dns.service%3B%20do%20sleep%201%3B%20done%0Afi%0A",
          "verification": {}
        },
        "mode": 484,
        "user": {},
        "group": {}
      },
      {
        "filesystem": "root",
        "path": "/etc/mesosphere/setup-flags/cluster-packages.json",
        "contents": {
          "source": "data:,%5B%223dt--caa28740ba55b7f6de50ab574e91a3f087701e7a%22%2C%20%22adminrouter--a4c1e2c311b66185e3fc26350ef55086a4434b3c%22%2C%20%22avro-cpp--6d585e71630922f860dd48538bf8ba19e15e3083%22%2C%20%22boost-libs--2015ccb58fb756f61c02ee6aa05cc1e27459a9ec%22%2C%20%22bootstrap--0e35d51178b06f342d2c1f5269f816dc2e840e5f%22%2C%20%22boto--6344d31eef082c7bd13259b17034ea7b5c34aedf%22%2C%20%22check-time--be7d0ba757ec87f9965378fee7c76a6ee5ae996d%22%2C%20%22cni--e48337da39a8cd379414acfe0da52a9226a10d24%22%2C%20%22cosmos--e51eff0287fa62a5c3f119bf49596f616eafad72%22%2C%20%22curl--fc3486c43f98e63f9b12675f1356e8fe842f26b0%22%2C%20%22dcos-config--setup_0b5997d4e89fa5d5eb365a9e368db148fbb0fa3f%22%2C%20%22dcos-history--2e58051de37d3cb9e1ffd83337933696100ac01c%22%2C%20%22dcos-image--165b814650bb7997dd399d45b7aaa2930fd56f5d%22%2C%20%22dcos-image-deps--83584fd868e5b470f7cf754424a9a75b328e9b68%22%2C%20%22dcos-integration-test--46c7a18bf99f132826095f77389a0efc9a6add8b%22%2C%20%22dcos-log--4d630df863228f38c6333e44670b4c4b20a74832%22%2C%20%22dcos-metadata--setup_0b5997d4e89fa5d5eb365a9e368db148fbb0fa3f%22%2C%20%22dcos-metrics--eeed452d4a29762e14563874340a73b4d79c0438%22%2C%20%22dcos-oauth--0079529da183c0f23a06d2b069721b6fa6cc7b52%22%2C%20%22dcos-signal--5633dc8da7e864cb34e3d29ed13e6756c7a6df94%22%2C%20%22dcos-ui--5f983887ce5d4c347b5b64982a7436274a71854b%22%2C%20%22dnspython--0f833eb9a8abeba3179b43f3a200a8cd42d3795a%22%2C%20%22docker-gc--59a98ed6446a084bf74e4ff4b8e3479f59ea8528%22%2C%20%22dvdcli--5374dd4ffb519f1dcefdec89b2247e3404f2e2e3%22%2C%20%22erlang--a9ee2530357a3301e53056b36a93420847b339a3%22%2C%20%22exhibitor--6be3f543dbed3abbc22218fd703e52609bc49a67%22%2C%20%22flask--26d1bcdb2d1c3dcf1d2c03bc0d4f29c86d321b21%22%2C%20%22java--cd5e921ce66b0d3303883c06d73a657314044304%22%2C%20%22libevent--208be855d2be29c9271a7bd6c04723ff79946e02%22%2C%20%22libffi--83ce3bd7eda2ef089e57efd2bc16c144d5a1f094%22%2C%20%22libsodium--9ff915db08c6bba7d6738af5084e782b13c84bf8%22%2C%20%22logrotate--7f7bc4416d3ad101d0c5218872858483b516be07%22%2C%20%22marathon--8f59f94aaa21adbe497e0f49a8d0bb41515968db%22%2C%20%22mesos--9f6b69d99c090233d393326801f29df3d0a02946%22%2C%20%22mesos-dns--cddd24b0303ee78e44b0411482164aaa912d02a8%22%2C%20%22mesos-modules--5e6e24770813eaf35905a4e37ff292a4e6546ec2%22%2C%20%22metronome--6eafabd93182e8844c72ce19690e93d2b7926931%22%2C%20%22navstar--0b141af667446bbe42069fbdba130276f872061c%22%2C%20%22ncurses--d889894b71aa1a5b311bafef0e85479025b4dacb%22%2C%20%22octarine--6d19cc951bac94fe244e93874458b4eb9869470e%22%2C%20%22openssl--b01a32a42e3ccba52b417276e9509a441e1d4a82%22%2C%20%22pkgpanda-api--44ef11ff2c301d635324b44c0cd715e365acd6f6%22%2C%20%22pkgpanda-role--f8a749a4a821476ad2ef7e9dd9d12b6a8c4643a4%22%2C%20%22pytest--78aee3e58a049cdab0d266af74f77d658b360b4f%22%2C%20%22python--b7a144a49577a223d37d447c568f51330ee95390%22%2C%20%22python-azure-mgmt-resource--03c05550f43b0e7a4455c33fe43b0deb755d87f0%22%2C%20%22python-cryptography--4184767c68e48801dd394072cb370c610a05029d%22%2C%20%22python-dateutil--fdc6ff929f65dd0918cf75a9ad56704683d31781%22%2C%20%22python-docopt--beba78faa13e5bf4c52393b4b82d81f3c391aa65%22%2C%20%22python-gunicorn--a537f95661fb2689c52fe12510eb0d01cb83af60%22%2C%20%22python-isodate--40d378c688e6badfd16676dd8b51b742bfebc8d5%22%2C%20%22python-jinja2--7450f5ae5a822f63f7a58c717207be0456df51ed%22%2C%20%22python-kazoo--cb7ce13a1068cd82dd84ea0de32b529a760a4bdd%22%2C%20%22python-markupsafe--dd46d2a3c58611656a235f96d4adc51b2a7a590e%22%2C%20%22python-passlib--802ec3605c0b82428fedba60983b1bafaa036bb8%22%2C%20%22python-pyyaml--81dd44cc4a24db7cefa7016c6586a131acf279c3%22%2C%20%22python-requests--1b2cadbd3811cc0c2ee235ce927e13ea1d6af41d%22%2C%20%22python-retrying--eb7b8bac133f50492b1e1349cbe77c3e38bd02c3%22%2C%20%22python-tox--07244f8a939a10353634c952c6d88ec4a3c05736%22%2C%20%22rexray--f07795e2c10f9a1a27de9d8e67ab171029db2e1d%22%2C%20%22six--f06424b68523c4dfa2a7c3e7475d479f3d361e42%22%2C%20%22spartan--daba6f5a190e67874b3aa852601ba039ecbab039%22%2C%20%22strace--7d01796d64994451c1b2b82d161a335cbe90569b%22%2C%20%22teamcity-messages--e623a4d86eb3a8d199cefcc240dd4c5460cb2962%22%2C%20%22toybox--f235594ab8ea9a2864ee72abe86723d76f92e848%22%5D%0A",
          "verification": {}
        },
        "mode": 420,
        "user": {},
        "group": {}
      }
    ]
  },
  "systemd": {
    "units": [
      {
        "name": "sssd.service",
        "enable": true
      },
      {
        "name": "etcd.service",
        "mask": true
      },
      {
        "name": "systemd-resolved.service"
      },
      {
        "name": "systemd-journald.service",
        "enable": true
      },
      {
        "name": "kernel-tuning.service",
        "enable": true,
        "contents": "[Unit]\nDescription=Kernel tuning for Ethos hosts\n[Service]\nType=oneshot\nStandardOutput=journal+console\nStandardError=journal+console\nExecStartPre=/usr/lib/systemd/systemd-sysctl\nExecStartPre=/usr/lib/systemd/systemd-modules-load\nExecStart=/bin/bash -c \"exit 0\"\n[Install]\nWantedBy=multi-user.target\n"
      },
      {
        "name": "docker.service",
        "dropins": [
          {
            "name": "10-docker-opts.conf",
            "contents": "[Service]\nEnvironment=\"DOCKER_OPTS=--log-driver=json-file --log-opt max-size=10m --log-opt max-file=3\"\nLimitMEMLOCK=infinity\n"
          }
        ]
      },
      {
        "name": "dcos-link-env.service",
        "enable": true,
        "contents": "[Unit]\nBefore=dcos.target\n[Service]\nType=oneshot\nStandardOutput=journal+console\nStandardError=journal+console\nExecStartPre=/usr/bin/mkdir -p /etc/profile.d\nExecStart=/usr/bin/ln -sf /opt/mesosphere/bin/add_dcos_path.sh /etc/profile.d/dcos.sh\n[Install]\nWantedBy=multi-user.target\n"
      },
      {
        "name": "dcos-download.service",
        "enable": true,
        "contents": "[Unit]\nDescription=Pkgpanda: Download DC/OS to this host.\nAfter=network-online.target\nWants=network-online.target\nConditionPathExists=!/opt/mesosphere/\n[Service]\nEnvironmentFile=/etc/mesosphere/setup-flags/bootstrap-id\nType=oneshot\nStandardOutput=journal+console\nStandardError=journal+console\nExecStartPre=/usr/bin/curl --keepalive-time 2 -fLsSv --retry 20 -Y 100000 -y 60 -o /tmp/bootstrap.tar.xz https://downloads.dcos.io/dcos/stable/bootstrap/${BOOTSTRAP_ID}.bootstrap.tar.xz\nExecStartPre=/usr/bin/mkdir -p /opt/mesosphere\nExecStart=/usr/bin/tar -axf /tmp/bootstrap.tar.xz -C /opt/mesosphere\nExecStartPost=-/usr/bin/rm -f /tmp/bootstrap.tar.xz\n"
      },
      {
        "name": "dcos-setup.service",
        "enable": true,
        "contents": "[Unit]\nDescription=Pkgpanda: Specialize DC/OS for this host.\nRequires=dcos-download.service\nAfter=dcos-download.service\n[Service]\nType=oneshot\nStandardOutput=journal+console\nStandardError=journal+console\nEnvironmentFile=/opt/mesosphere/environment\nExecStart=/opt/mesosphere/bin/pkgpanda setup --no-block-systemd\n[Install]\nWantedBy=multi-user.target\n"
      },
      {
        "name": "dcos-mesos-master.service",
        "dropins": [
          {
            "name": "10-dcos-mesos-authentication.conf",
            "contents": "[Unit]\nAfter=ethos-auth.service\n[Service]\nEnvironment=SASL_PATH=/opt/mesosphere/lib/sasl2\nEnvironment=MESOS_AUTHENTICATE=true\nEnvironment=MESOS_CREDENTIALS=/etc/ethos/dcos-mesos-master-secrets\nEnvironment=MESOS_AUTHENTICATE_AGENTS=true\nEnvironment=MESOS_AUTHENTICATORS=crammd5\n"
          },
          {
            "name": "11-dcos-mesos-master-ssl.conf",
            "contents": "[Unit]\nAfter=dcos-sslframework-setup.service\n[Service]\nEnvironmentFile=/etc/ethos/mesos.env\n"
          },
          {
            "name": "12-dcos-mesos-master-timeout.conf",
            "contents": "[Service]\nEnvironment=MESOS_SLAVE_REMOVAL_RATE_LIMIT=1/2mins\n"
          },
          {
            "name": "13-dcos-mesos-master-max-completed.conf",
            "contents": "[Service]\nEnvironment=MESOS_MAX_COMPLETED_TASKS_PER_FRAMEWORK=20\n"
          }
        ]
      },
      {
        "name": "dcos-metronome.service",
        "dropins": [
          {
            "name": "10-dcos-metronome-framework-auth.conf",
            "contents": "[Unit]\nAfter=ethos-auth.service\n[Service]\nEnvironment=SASL_PATH=/opt/mesosphere/lib/sasl2\nEnvironment=METRONOME_MESOS_AUTHENTICATION_PRINCIPAL=dcos-metronome\nEnvironment=METRONOME_MESOS_AUTHENTICATION_SECRET_FILE=/etc/ethos/dcos-metronome-secret\n"
          },
          {
            "name": "11-dcos-metronome-max-completed.conf",
            "contents": "[Service]\nEnvironment=METRONOME_HISTORY_COUNT=20\n"
          }
        ]
      },
      {
        "name": "dcos-mesos-slave.service",
        "dropins": [
          {
            "name": "10-dcos-mesos-agent-auth.conf",
            "contents": "[Unit]\nAfter=ethos-auth.service\n[Service]\nEnvironment=SASL_PATH=/opt/mesosphere/lib/sasl2\nEnvironment=MESOS_CREDENTIAL=/etc/ethos/dcos-mesos-agent-secret\n"
          },
          {
            "name": "11-dcos-mesos-agent-ssl.conf",
            "contents": "[Unit]\nAfter=dcos-sslframework-setup.service\n[Service]\nEnvironmentFile=/etc/ethos/mesos.env\n"
          },
          {
            "name": "12-dcos-mesos-agent-disk.conf",
            "contents": "[Service]\nExecStartPre=\nExecStartPre=/bin/ping -c1 ready.spartan\nExecStartPre=/bin/ping -c1 leader.mesos\nExecStartPre=/opt/mesosphere/bin/bootstrap dcos-mesos-slave\nExecStartPre=/opt/ethos/bin/make_disk_resources.py /var/lib/dcos/mesos-resources\nExecStartPre=/bin/bash -c 'for i in /proc/sys/net/ipv4/conf/*/rp_filter; do echo 2 \u003e $i; echo -n \"$i: \"; cat $i; done'\n"
          }
        ]
      },
      {
        "name": "dcos-mesos-slave-public.service",
        "dropins": [
          {
            "name": "10-dcos-mesos-agent-public-auth.conf",
            "contents": "[Unit]\nAfter=ethos-auth.service\n[Service]\nEnvironment=SASL_PATH=/opt/mesosphere/lib/sasl2\nEnvironment=MESOS_CREDENTIAL=/etc/ethos/dcos-mesos-agent-secret\n"
          },
          {
            "name": "11-dcos-mesos-agent-public-ssl.conf",
            "contents": "[Unit]\nAfter=dcos-sslframework-setup.service\n[Service]\nEnvironmentFile=/etc/ethos/mesos.env\n"
          },
          {
            "name": "12-dcos-mesos-agent-public-disk.conf",
            "contents": "[Service]\nExecStartPre=\nExecStartPre=/bin/ping -c1 ready.spartan\nExecStartPre=/bin/ping -c1 leader.mesos\nExecStartPre=/opt/mesosphere/bin/bootstrap dcos-mesos-slave-public\nExecStartPre=/opt/ethos/bin/make_disk_resources.py /var/lib/dcos/mesos-resources\nExecStartPre=/bin/bash -c 'for i in /proc/sys/net/ipv4/conf/*/rp_filter; do echo 2 \u003e $i; echo -n \"$i: \"; cat $i; done'\n"
          }
        ]
      },
      {
        "name": "dcos-marathon.service",
        "dropins": [
          {
            "name": "10-dcos-marathon-framework-auth.conf",
            "contents": "[Unit]\nAfter=ethos-auth.service\n[Service]\nEnvironment=SASL_PATH=/opt/mesosphere/lib/sasl2\nEnvironment=MARATHON_CMD_MESOS_AUTHENTICATION=\nEnvironment=MARATHON_CMD_MESOS_AUTHENTICATION_SECRET_FILE=/etc/ethos/dcos-marathon-secret\n"
          },
          {
            "name": "11-dcos-marathon-ssl.conf",
            "contents": "[Unit]\nAfter=dcos-sslframework-setup.service\n[Service]\nExecStartPre=/opt/ethos/bin/dcos-marathon-ssl\n"
          }
        ]
      },
      {
        "name": "dcos-exhibitor.service",
        "dropins": [
          {
            "name": "10-dcos-exhibitor-framework-ssl.conf",
            "contents": "[Unit]\nAfter=dcos-sslframework-setup.service\n[Service]\nExecStartPre=/opt/ethos/bin/dcos-exhibitor-ssl\n"
          }
        ]
      },
      {
        "name": "dcos-sslframework-setup.service",
        "enable": true,
        "contents": "[Unit]\nDescription=SSLFramework: Setup SSL Framework Communications.\nRequires=dcos-download.service\nAfter=network-online.target\nWants=network-online.target\n[Service]\nUser=root\nType=oneshot\nStandardOutput=journal+console\nStandardError=journal+console\nExecStart=/opt/ethos/bin/dcos-sslframework-setup\n[Install]\nWantedBy=multi-user.target\n"
      },
      {
        "name": "format-and-mount-disks.service",
        "enable": true,
        "contents": "[Unit]\nDescription=AWS Setup: Detects and mounts disk\nBefore=ethos-files.mount dbus.service\nConditionPathExists=|/etc/mesosphere/roles/aws\nConditionPathExists=|/etc/mesosphere/roles/azure\n[Service]\nType=oneshot\nRemainAfterExit=yes\nExecStart=-/bin/bash /opt/ethos/bin/format-and-mount-disks\n[Install]\nWantedBy=multi-user.target\n"
      },
      {
        "name": "dcos-config-writer.service",
        "enable": true,
        "contents": "[Unit]\nRequires=dcos-setup.service\nAfter=dcos-setup.service\nConditionPathExists=/etc/mesosphere/roles/azure\n[Service]\nType=oneshot\nEnvironmentFile=/etc/environment\nEnvironmentFile=/opt/mesosphere/environment\nExecStart=/usr/bin/bash -c \"echo $(detect_ip) $(hostname) \\u003e /etc/hosts\"\n[Install]\nWantedBy=multi-user.target\n"
      },
      {
        "name": "dcos-ip-detect.service",
        "enable": true,
        "contents": "[Unit]\nDescription=Rewrite of IP Detect script for DC/OS\nRequires=dcos-setup.service\nAfter=dcos-setup.service\n[Service]\nType=oneshot\nStandardOutput=journal+console\nStandardError=journal+console\nExecStartPre=/bin/cp /etc/ip_detect /opt/mesosphere/bin/detect_ip\nExecStartPre=/bin/cp /etc/ip_detect /opt/mesosphere/bin/detect_ip_public\nExecStart=/opt/mesosphere/bin/detect_ip\n[Install]\nWantedBy=multi-user.target\n"
      },
      {
        "name": "ethos-auth.service",
        "enable": true,
        "contents": "[Unit]\nDescription=Ethos Setup: Auth Generation\nConditionPathExists=/etc/ethos/auth.env\nAfter=network-online.target\n[Service]\nType=oneshot\nRemainAfterExit=yes\nExecStart=/bin/bash /opt/ethos/bin/setup-auth-files\n[Install]\nWantedBy=multi-user.target\n"
      },
      {
        "name": "coreos-curl.service",
        "enable": true,
        "contents": "[Unit]\nDescription=Address incompatible libcurl on CoreOS\nRequires=dcos-download.service\nAfter=dcos-download.service\nBefore=dcos-setup.service\n[Service]\nType=oneshot\nStandardOutput=journal+console\nStandardError=journal+console\nExecStart=/bin/bash -c 'sed -i s,/usr/bin/curl,/opt/mesosphere/bin/curl, $(find /opt/mesosphere -type f -print0 | xargs -0 fgrep -l /usr/bin/curl) ||:'\n[Install]\nWantedBy=multi-user.target\n"
      },
      {
        "name": "upstream-dns.service",
        "enable": true,
        "contents": "[Unit]\nDescription=Set upstream DNS resolvers\nRequires=dcos-setup.service\nAfter=dcos-setup.service\nConditionPathExists=|/etc/mesosphere/roles/azure\nConditionPathExists=|/etc/mesosphere/roles/datacenter\n[Service]\nType=oneshot\nStandardOutput=journal+console\nStandardError=journal+console\nEnvironmentFile=/etc/ethos/upstream-dns.env\nExecStart=/bin/bash /opt/ethos/bin/configure_upstream_dns\n[Install]\nWantedBy=multi-user.target\n"
      }
    ]
  },
  "networkd": {},
  "passwd": {}
}
